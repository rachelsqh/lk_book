<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>内核测试指南 &mdash; Rachel&#39;s E-book 1.0 documentation</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Rachel's E-book
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../csxj/index.html">处世悬镜</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Rachel's E-book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>内核测试指南</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/lk_devel/lk_comp/dev-tool/k_test.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="id1">
<h1>内核测试指南<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>大部分内核测试都是使用kselftest或 KUnit 框架编写的。它们都提供了基础设施来帮助更轻松地运行测试和测试组，并提供帮助程序来帮助编写新测试。如果您希望验证内核的行为——尤其是内核的特定部分——那么您将需要使用 KUnit 或 kselftest。</p>
<div class="section" id="kunit-kselftest">
<h2>KUnit 和 kselftest 的区别<a class="headerlink" href="#kunit-kselftest" title="Permalink to this headline">¶</a></h2>
<p>KUnit（KUnit - Linux Kernel 的单元测试）是一个完全在内核中的系统，用于“白盒”测试：因为测试代码是内核的一部分，它可以访问不暴露给用户空间的内部结构和函数。因此，KUnit 测试最好针对内核的小而独立的部分编写，这些部分可以单独进行测试。这与“单元”测试的概念非常吻合。</p>
<p>例如，KUnit 测试可能会测试单个内核函数（甚至是通过函数的单个代码路径，例如错误处理案例），而不是整个特性。这也使得 KUnit 测试的构建和运行速度非常快，允许它们作为开发过程的一部分频繁运行。有一个 KUnit 测试风格指南，它可能会在测试风格和命名法中提供进一步的指示。</p>
<p>另一方面，kselftest（Linux Kernel Selftests）主要是在用户空间中实现的，测试是普通的用户空间脚本或程序。</p>
<p>这使得编写更复杂的测试或需要更多地操纵整个系统状态的测试（例如，生成进程等）变得更容易。但是，不能直接从 kselftest 调用内核函数。这意味着只有以某种方式（例如通过系统调用、设备、文件系统等）暴露给用户空间的内核功能才能使用 kselftest 进行测试。为了解决这个问题，一些测试包括一个配套的内核模块，它公开了更多的信息或功能。但是，如果测试大部分或完全在内核中运行，KUnit 可能是更合适的工具。</p>
<p>因此，kselftest 非常适合测试整个功能，因为这些将向用户空间公开一个接口，该接口可以测试，但不能测试实现细节。这与“系统”或“端到端”测试非常吻合。</p>
<p>例如，所有新的系统调用都应该伴随着 kselftest 测试。</p>
</div>
<div class="section" id="id2">
<h2>代码覆盖工具<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Linux 内核支持两种不同的代码覆盖率测量工具。这些可用于验证测试是否正在执行特定的功能或代码行。这对于确定正在测试多少内核以及查找适当测试未涵盖的极端情况很有用。
在 Linux 内核中使用 gcov是 GCC 的覆盖率测试工具，它可以与内核一起使用以获得全局或每个模块的覆盖率。与 KCOV 不同，它不记录每个任务的覆盖率。覆盖数据可以从 debugfs 中读取，并使用常用的 gcov 工具进行解释。</p>
<p>kcov：模糊测试的代码覆盖率是一个可以内置到内核中的功能，以允许在每个任务级别捕获覆盖率。因此，它对于模糊测试和其他有关在例如单个系统调用期间执行的代码的信息很有用的情况很有用。</p>
</div>
<div class="section" id="id3">
<h2>动态分析工具<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>内核还支持许多动态分析工具，当它们出现在正在运行的内核中时，它们会尝试检测问题类别。这些通常会寻找不同类别的错误，例如无效的内存访问、并发问题（例如数据竞争）或其他未定义的行为（例如整数溢出）。</p>
<p>下面列出了其中一些工具：</p>
<ul class="simple">
<li><p>kmemleak 检测可能的内存泄漏。请参阅 内核内存泄漏检测器</p></li>
<li><p>KASAN 检测无效的内存访问，例如越界和释放后使用错误。请参阅内核地址清理程序 (KASAN)</p></li>
<li><p>UBSAN 检测 C 标准未定义的行为，例如整数溢出。请参阅未定义的行为消毒剂 - UBSAN</p></li>
<li><p>KCSAN 检测数据竞争。请参阅内核并发清理程序 (KCSAN)</p></li>
<li><p>KFENCE 是一种内存问题的低开销检测器，它比 KASAN 快得多，并且可以在生产中使用。参见内核电子围栏 (KFENCE)</p></li>
<li><p>lockdep 是一个锁定正确性验证器。请参阅 运行时锁定正确性验证器</p></li>
<li><p>内核中还有其他几个调试工具，其中许多可以在 lib/Kconfig.debug 中找到</p></li>
</ul>
<p>这些工具倾向于将内核作为一个整体进行测试，而不是像 kselftest 或 KUnit 测试那样“通过”。通过在启用这些工具的内核上运行测试，它们可以与 KUnit 或 kselftest 结合使用：然后您可以确保在测试期间不会发生这些错误。
其中一些工具与 KUnit 或 kselftest 集成，如果检测到问题，将自动失败测试。</p>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Rachel.Sun.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>