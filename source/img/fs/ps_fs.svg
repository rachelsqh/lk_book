<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="2036pt" height="693pt"
 viewBox="0.00 0.00 2036.00 692.64" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 688.64)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-688.64 2032,-688.64 2032,4 -4,4"/>
<text text-anchor="middle" x="1014" y="-7.8" font-family="Times,serif" font-size="14.00">linux vfs</text>
<!-- init_task -->
<g id="node1" class="node">
<title>init_task</title>
<polygon fill="none" stroke="black" points="1081.5,-528.14 1081.5,-684.14 1289.5,-684.14 1289.5,-528.14 1081.5,-528.14"/>
<text text-anchor="middle" x="1185.5" y="-667.34" font-family="Times,serif" font-size="16.00">struct task_struct init_task = {</text>
<polyline fill="none" stroke="black" points="1081.5,-658.14 1289.5,-658.14 "/>
<text text-anchor="middle" x="1185.5" y="-641.34" font-family="Times,serif" font-size="16.00">...</text>
<polyline fill="none" stroke="black" points="1081.5,-632.14 1289.5,-632.14 "/>
<text text-anchor="middle" x="1185.5" y="-615.34" font-family="Times,serif" font-size="16.00">.fs = &amp;init_fs,</text>
<polyline fill="none" stroke="black" points="1081.5,-606.14 1289.5,-606.14 "/>
<text text-anchor="middle" x="1185.5" y="-589.34" font-family="Times,serif" font-size="16.00">.files = &amp;init_files,</text>
<polyline fill="none" stroke="black" points="1081.5,-580.14 1289.5,-580.14 "/>
<text text-anchor="middle" x="1185.5" y="-563.34" font-family="Times,serif" font-size="16.00">...</text>
<polyline fill="none" stroke="black" points="1081.5,-554.14 1289.5,-554.14 "/>
<text text-anchor="middle" x="1185.5" y="-537.34" font-family="Times,serif" font-size="16.00">}</text>
</g>
<!-- init_fs -->
<g id="node2" class="node">
<title>init_fs</title>
<polygon fill="none" stroke="black" points="1690,-134.14 1690,-264.14 1869,-264.14 1869,-134.14 1690,-134.14"/>
<text text-anchor="middle" x="1779.5" y="-247.34" font-family="Times,serif" font-size="16.00">struct fs_struct init_fs = {</text>
<polyline fill="none" stroke="black" points="1690,-238.14 1869,-238.14 "/>
<text text-anchor="middle" x="1779.5" y="-221.34" font-family="Times,serif" font-size="16.00">...</text>
<polyline fill="none" stroke="black" points="1690,-212.14 1869,-212.14 "/>
<text text-anchor="middle" x="1779.5" y="-195.34" font-family="Times,serif" font-size="16.00">.pwd = NULL</text>
<polyline fill="none" stroke="black" points="1690,-186.14 1869,-186.14 "/>
<text text-anchor="middle" x="1779.5" y="-169.34" font-family="Times,serif" font-size="16.00">.root = NULL</text>
<polyline fill="none" stroke="black" points="1690,-160.14 1869,-160.14 "/>
<text text-anchor="middle" x="1779.5" y="-143.34" font-family="Times,serif" font-size="16.00">}</text>
</g>
<!-- init_task&#45;&gt;init_fs -->
<g id="edge2" class="edge">
<title>init_task:f2&#45;&gt;init_fs:f0</title>
<path fill="none" stroke="black" d="M1290.5,-619.14C1407.08,-619.14 1445.05,-595.67 1533,-519.14 1634.5,-430.84 1556.16,-260.1 1679.91,-251.48"/>
<polygon fill="black" stroke="black" points="1680.12,-254.98 1690,-251.14 1679.89,-247.98 1680.12,-254.98"/>
</g>
<!-- fs_struct -->
<g id="node3" class="node">
<title>fs_struct</title>
<polygon fill="none" stroke="black" points="1906,-285.14 1906,-415.14 2028,-415.14 2028,-285.14 1906,-285.14"/>
<text text-anchor="middle" x="1967" y="-398.34" font-family="Times,serif" font-size="16.00">struct fs_struct {</text>
<polyline fill="none" stroke="black" points="1906,-389.14 2028,-389.14 "/>
<text text-anchor="middle" x="1967" y="-372.34" font-family="Times,serif" font-size="16.00">...</text>
<polyline fill="none" stroke="black" points="1906,-363.14 2028,-363.14 "/>
<text text-anchor="middle" x="1967" y="-346.34" font-family="Times,serif" font-size="16.00">struct path root;</text>
<polyline fill="none" stroke="black" points="1906,-337.14 2028,-337.14 "/>
<text text-anchor="middle" x="1967" y="-320.34" font-family="Times,serif" font-size="16.00">struct path pwd;</text>
<polyline fill="none" stroke="black" points="1906,-311.14 2028,-311.14 "/>
<text text-anchor="middle" x="1967" y="-294.34" font-family="Times,serif" font-size="16.00">}</text>
</g>
<!-- init_fs&#45;&gt;fs_struct -->
<g id="edge1" class="edge">
<title>init_fs:f0&#45;&gt;fs_struct</title>
<path fill="none" stroke="black" d="M1869,-251.14C1893.18,-251.14 1913.33,-266.4 1928.88,-284.94"/>
</g>
<!-- a1 -->
<g id="node5" class="node">
<title>a1</title>
<polygon fill="none" stroke="black" points="2011.5,-190.14 1922.5,-190.14 1922.5,-154.14 2011.5,-154.14 2011.5,-190.14"/>
<text text-anchor="middle" x="1967" y="-168.34" font-family="Times,serif" font-size="16.00">set_fs_pwd</text>
</g>
<!-- init_fs&#45;&gt;a1 -->
<g id="edge5" class="edge">
<title>init_fs:f2&#45;&gt;a1</title>
<path fill="none" stroke="black" d="M1869,-199.14C1883.35,-199.14 1898.47,-196.37 1912.39,-192.6"/>
<polygon fill="black" stroke="black" points="1913.67,-195.87 1922.28,-189.7 1911.7,-189.15 1913.67,-195.87"/>
</g>
<!-- b1 -->
<g id="node6" class="node">
<title>b1</title>
<polygon fill="none" stroke="black" points="2011,-96.14 1923,-96.14 1923,-60.14 2011,-60.14 2011,-96.14"/>
<text text-anchor="middle" x="1967" y="-74.34" font-family="Times,serif" font-size="16.00">set_fs_root</text>
</g>
<!-- init_fs&#45;&gt;b1 -->
<g id="edge6" class="edge">
<title>init_fs:f3&#45;&gt;b1</title>
<path fill="none" stroke="black" d="M1869,-173.14C1878.91,-173.14 1917.67,-132.14 1943.09,-104.01"/>
<polygon fill="black" stroke="black" points="1945.79,-106.24 1949.87,-96.46 1940.58,-101.56 1945.79,-106.24"/>
</g>
<!-- path -->
<g id="node4" class="node">
<title>path</title>
<polygon fill="none" stroke="black" points="1700,-283.14 1700,-387.14 1859,-387.14 1859,-283.14 1700,-283.14"/>
<text text-anchor="middle" x="1779.5" y="-370.34" font-family="Times,serif" font-size="16.00">struct path {</text>
<polyline fill="none" stroke="black" points="1700,-361.14 1859,-361.14 "/>
<text text-anchor="middle" x="1779.5" y="-344.34" font-family="Times,serif" font-size="16.00">struct vfsmount *mnt;</text>
<polyline fill="none" stroke="black" points="1700,-335.14 1859,-335.14 "/>
<text text-anchor="middle" x="1779.5" y="-318.34" font-family="Times,serif" font-size="16.00">struct dentry *dentry;</text>
<polyline fill="none" stroke="black" points="1700,-309.14 1859,-309.14 "/>
<text text-anchor="middle" x="1779.5" y="-292.34" font-family="Times,serif" font-size="16.00">}</text>
</g>
<!-- path&#45;&gt;fs_struct -->
<g id="edge3" class="edge">
<title>path:f0&#45;&gt;fs_struct:f2</title>
<path fill="none" stroke="black" d="M1860.5,-374.14C1874.21,-374.14 1875.89,-366.59 1888,-360.14 1896.08,-355.85 1896.85,-350.14 1906,-350.14"/>
</g>
<!-- path&#45;&gt;fs_struct -->
<g id="edge4" class="edge">
<title>path:f0&#45;&gt;fs_struct:f3</title>
<path fill="none" stroke="black" d="M1860.5,-374.14C1890.55,-374.14 1875.95,-324.14 1906,-324.14"/>
</g>
<!-- new_task -->
<g id="node7" class="node">
<title>new_task</title>
<polygon fill="none" stroke="black" points="312,-257.14 312,-413.14 512,-413.14 512,-257.14 312,-257.14"/>
<text text-anchor="middle" x="412" y="-396.34" font-family="Times,serif" font-size="16.00">struct task_struct new_task {</text>
<polyline fill="none" stroke="black" points="312,-387.14 512,-387.14 "/>
<text text-anchor="middle" x="412" y="-370.34" font-family="Times,serif" font-size="16.00">...</text>
<polyline fill="none" stroke="black" points="312,-361.14 512,-361.14 "/>
<text text-anchor="middle" x="412" y="-344.34" font-family="Times,serif" font-size="16.00">struct fs_struct *fs;</text>
<polyline fill="none" stroke="black" points="312,-335.14 512,-335.14 "/>
<text text-anchor="middle" x="412" y="-318.34" font-family="Times,serif" font-size="16.00">struct files_struct *file</text>
<polyline fill="none" stroke="black" points="312,-309.14 512,-309.14 "/>
<text text-anchor="middle" x="412" y="-292.34" font-family="Times,serif" font-size="16.00">...</text>
<polyline fill="none" stroke="black" points="312,-283.14 512,-283.14 "/>
<text text-anchor="middle" x="412" y="-266.34" font-family="Times,serif" font-size="16.00">}</text>
</g>
<!-- new_task&#45;&gt;init_task -->
<g id="edge7" class="edge">
<title>new_task:f2&#45;&gt;init_task:f2</title>
<path fill="none" stroke="black" d="M522.13,-348.26C792.16,-354.72 804.01,-619.14 1080.5,-619.14"/>
<polygon fill="black" stroke="black" points="522.04,-344.76 512,-348.14 521.96,-351.76 522.04,-344.76"/>
<text text-anchor="middle" x="675" y="-502.94" font-family="Times,serif" font-size="14.00">fork() : new_task&#45;&gt;fs = copy_fs_struct(init_task&#45;&gt;fs)</text>
</g>
<!-- files_struct -->
<g id="node12" class="node">
<title>files_struct</title>
<polygon fill="none" stroke="black" points="838,-135.14 838,-509.14 1533,-509.14 1533,-135.14 838,-135.14"/>
<text text-anchor="middle" x="1185.5" y="-492.34" font-family="Times,serif" font-size="16.00">struct files_struct {</text>
<polyline fill="none" stroke="black" points="838,-483.14 1533,-483.14 "/>
<text text-anchor="middle" x="1185.5" y="-466.34" font-family="Times,serif" font-size="16.00">atomic_t count;</text>
<polyline fill="none" stroke="black" points="838,-457.14 1533,-457.14 "/>
<text text-anchor="middle" x="1185.5" y="-440.34" font-family="Times,serif" font-size="16.00">bool resize_in_progress;</text>
<polyline fill="none" stroke="black" points="838,-431.14 1533,-431.14 "/>
<text text-anchor="middle" x="1185.5" y="-414.34" font-family="Times,serif" font-size="16.00">wait_queue_head_t resize_wait;</text>
<polyline fill="none" stroke="black" points="838,-405.14 1533,-405.14 "/>
<text text-anchor="middle" x="1185.5" y="-388.34" font-family="Times,serif" font-size="16.00">struct fdtable __rcu *fdt;</text>
<polyline fill="none" stroke="black" points="838,-379.14 1533,-379.14 "/>
<text text-anchor="middle" x="1185.5" y="-362.34" font-family="Times,serif" font-size="16.00">struct fdtable fdtab;</text>
<polyline fill="none" stroke="black" points="838,-353.14 1533,-353.14 "/>
<text text-anchor="middle" x="1185.5" y="-336.34" font-family="Times,serif" font-size="16.00">spinlock_t file_lock ____cacheline_aligned_in_smp;</text>
<polyline fill="none" stroke="black" points="838,-327.14 1533,-327.14 "/>
<text text-anchor="middle" x="1185.5" y="-310.34" font-family="Times,serif" font-size="16.00">unsigned int next_fd;</text>
<polyline fill="none" stroke="black" points="838,-301.14 1533,-301.14 "/>
<text text-anchor="middle" x="1185.5" y="-284.34" font-family="Times,serif" font-size="16.00">unsigned long close_on_exec_init[1];</text>
<polyline fill="none" stroke="black" points="838,-275.14 1533,-275.14 "/>
<text text-anchor="middle" x="1185.5" y="-258.34" font-family="Times,serif" font-size="16.00">unsigned long open_fds_init[1];</text>
<polyline fill="none" stroke="black" points="838,-249.14 1533,-249.14 "/>
<text text-anchor="middle" x="1185.5" y="-232.34" font-family="Times,serif" font-size="16.00">unsigned long full_fds_bits_init[1];</text>
<text text-anchor="middle" x="1185.5" y="-214.34" font-family="Times,serif" font-size="16.00">//fd占用位图，占用了则设置为1,未占用则为0</text>
<polyline fill="none" stroke="black" points="838,-205.14 1533,-205.14 "/>
<text text-anchor="middle" x="1185.5" y="-188.34" font-family="Times,serif" font-size="16.00">struct file __rcu * fd_array[NR_OPEN_DEFAULT];</text>
<text text-anchor="middle" x="1185.5" y="-170.34" font-family="Times,serif" font-size="16.00">//指向打开文件的struct file结构，每个进程最多打开：BITS_PER_LONG个文件，其下标对应文件fd</text>
<polyline fill="none" stroke="black" points="838,-161.14 1533,-161.14 "/>
<text text-anchor="middle" x="1185.5" y="-144.34" font-family="Times,serif" font-size="16.00">}</text>
</g>
<!-- new_task&#45;&gt;files_struct -->
<g id="edge15" class="edge">
<title>new_task:f3&#45;&gt;files_struct</title>
<path fill="none" stroke="black" d="M512,-322.14C617.81,-322.14 732.98,-322.14 837.63,-322.14"/>
</g>
<!-- new_fs -->
<g id="node8" class="node">
<title>new_fs</title>
<polygon fill="none" stroke="black" points="0,-26.14 0,-156.14 104,-156.14 104,-26.14 0,-26.14"/>
<text text-anchor="middle" x="52" y="-139.34" font-family="Times,serif" font-size="16.00">new_task:fs {</text>
<polyline fill="none" stroke="black" points="0,-130.14 104,-130.14 "/>
<text text-anchor="middle" x="52" y="-113.34" font-family="Times,serif" font-size="16.00">...</text>
<polyline fill="none" stroke="black" points="0,-104.14 104,-104.14 "/>
<text text-anchor="middle" x="52" y="-87.34" font-family="Times,serif" font-size="16.00">.pwd</text>
<polyline fill="none" stroke="black" points="0,-78.14 104,-78.14 "/>
<text text-anchor="middle" x="52" y="-61.34" font-family="Times,serif" font-size="16.00">.root</text>
<polyline fill="none" stroke="black" points="0,-52.14 104,-52.14 "/>
<text text-anchor="middle" x="52" y="-35.34" font-family="Times,serif" font-size="16.00">}</text>
</g>
<!-- new_fs&#45;&gt;new_task -->
<g id="edge8" class="edge">
<title>new_fs:f0&#45;&gt;new_task:f2</title>
<path fill="none" stroke="black" d="M104,-143.14C233.8,-143.14 182.2,-348.14 312,-348.14"/>
</g>
<!-- chroot -->
<g id="node9" class="node">
<title>chroot</title>
<polygon fill="none" stroke="black" points="1672,-65.14 1551,-65.14 1551,-29.14 1672,-29.14 1672,-65.14"/>
<text text-anchor="middle" x="1611.5" y="-43.34" font-family="Times,serif" font-size="16.00">chroot系统调用</text>
</g>
<!-- new_fs&#45;&gt;chroot -->
<g id="edge12" class="edge">
<title>new_fs:f3&#45;&gt;chroot</title>
<path fill="none" stroke="black" d="M104,-65.14C115.31,-65.14 111.74,-51.91 122,-47.14 198.86,-11.46 227.33,-34.7 312,-31.14 781.14,-11.43 1346.39,-34.38 1540.85,-43.63"/>
<polygon fill="black" stroke="black" points="1540.77,-47.13 1550.93,-44.11 1541.11,-40.14 1540.77,-47.13"/>
<text text-anchor="middle" x="412" y="-34.94" font-family="Times,serif" font-size="14.00">修改方式</text>
</g>
<!-- chdir -->
<g id="node10" class="node">
<title>chdir</title>
<polygon fill="none" stroke="black" points="731.5,-124.14 618.5,-124.14 618.5,-88.14 731.5,-88.14 731.5,-124.14"/>
<text text-anchor="middle" x="675" y="-102.34" font-family="Times,serif" font-size="16.00">chdir系统调用</text>
</g>
<!-- new_fs&#45;&gt;chdir -->
<g id="edge13" class="edge">
<title>new_fs:f2&#45;&gt;chdir</title>
<path fill="none" stroke="black" d="M104,-91.14C286.5,-91.14 501.76,-98.92 607.95,-103.28"/>
<polygon fill="black" stroke="black" points="608.05,-106.79 618.19,-103.7 608.34,-99.79 608.05,-106.79"/>
<text text-anchor="middle" x="208" y="-96.94" font-family="Times,serif" font-size="14.00">根据提供的路径名进行修改</text>
</g>
<!-- fchdir -->
<g id="node11" class="node">
<title>fchdir</title>
<polygon fill="none" stroke="black" points="734,-83.14 616,-83.14 616,-47.14 734,-47.14 734,-83.14"/>
<text text-anchor="middle" x="675" y="-61.34" font-family="Times,serif" font-size="16.00">fchdir系统调用</text>
</g>
<!-- new_fs&#45;&gt;fchdir -->
<g id="edge14" class="edge">
<title>new_fs:f2&#45;&gt;fchdir</title>
<path fill="none" stroke="black" d="M104,-91.14C115.31,-91.14 111.58,-77.55 122,-73.14 207.2,-37.13 477.74,-50.88 605.69,-59.82"/>
<polygon fill="black" stroke="black" points="605.54,-63.32 615.76,-60.53 606.03,-56.34 605.54,-63.32"/>
<text text-anchor="middle" x="208" y="-76.94" font-family="Times,serif" font-size="14.00">根据打开文件的fd进行修改</text>
</g>
<!-- chroot&#45;&gt;b1 -->
<g id="edge9" class="edge">
<title>chroot&#45;&gt;b1</title>
<path fill="none" stroke="black" d="M1672.07,-52.37C1739.49,-58.28 1848.33,-67.83 1912.94,-73.49"/>
<polygon fill="black" stroke="black" points="1912.65,-76.98 1922.92,-74.37 1913.26,-70.01 1912.65,-76.98"/>
</g>
<!-- chdir&#45;&gt;a1 -->
<g id="edge10" class="edge">
<title>chdir&#45;&gt;a1</title>
<path fill="none" stroke="black" d="M731.69,-105.41C825.24,-104.35 1019.89,-102.84 1184.5,-106.14"/>
</g>
<!-- fchdir&#45;&gt;a1 -->
<g id="edge11" class="edge">
<title>fchdir&#45;&gt;a1</title>
<path fill="none" stroke="black" d="M734.23,-72.14C828.6,-82.96 1020.9,-102.86 1184.5,-106.14"/>
<path fill="none" stroke="black" d="M1186.5,-106.14C1489.89,-112.23 1574.21,-53.16 1869,-125.14 1889.4,-130.13 1910.55,-139.77 1927.88,-149.04"/>
<polygon fill="black" stroke="black" points="1926.64,-152.35 1937.08,-154.11 1930.02,-146.22 1926.64,-152.35"/>
</g>
</g>
</svg>
